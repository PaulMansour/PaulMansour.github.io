<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"></meta>
    <link href="/ThorntonMelon.css" rel="stylesheet"></link>
  </head>
  <body>
    <header>
      <h1>Tool of Thought</h1>
      <h2>APL for the Practical Man</h2>
      <nav>
        <a href="/">Home</a>
        <a href="/posts">Posts</a>
        <a href="/projects">Projects</a>
        <a href="/reference">Reference</a>
        <a href="/donts">Don'ts</a>
        <a href="/hmmm">Hmmm</a>
        <a href="/links">Links</a>
        <a href="/about">About</a>
      </nav>
    </header>
    <main>
      <article>
        <header>
          <h1>
            <a href="/posts/session-configuration">Session Configuration</a>
          </h1>
          <h2>March 6, 2022</h2>
        </header>
        <p>When I get a new version of Dyalog (Windows), I go to the configuration
        dialog box and manually set some options. This is painful, error
        prone and a general waste of time. In addition, I increase the
        session font size, and save the session file. This is even worse,
        as saving the session file can have other deleterious effects.
        It has never been clear to me why it is necessary to save the session
        file simply to remember session font size. Anyway, it is way past
        time to change this entire routine.</p>
        <p>Dyalog 18.0 introduced some new features, techniques, and options
        for session configuration. The most important is the introduction
        of configuration files. Dyalog 18.2 brings some enhancments to
        these features. There is now a plethora of ways to intialize settings,
        configure things, and run code on starting the interpreter.</p>
        <p>
          When a new version of Dyalog is installed, I want to specify
          at most one thing: The UserConfigFile parameter. This parameter
          will point to my confuration file and, indirectly, its parent
          folder. This parent folder is my
          <strong>user configuration folder</strong>
          ; it contains the configuration file itself, as well as any other
          assets for configuring the sesssion like custom user commands
          and code that execute on startup.
        </p>
        <p>The user config file, and its encompassing user config folder,
        should be completely portable, which means that any file or path
        specified inside the config file should be relative to the location
        of the config file itself.</p>
        <p>
          Currently it looks like some parameters that take file names
          or paths as values will accept relative paths, but not all. The
          most important one for me that does not accept relative paths
          is the SALT/CommandFolder that specifies where to look for user
          commands. (I could probably hack this, but if I start looking
          at the APL code in
          <code>⎕SE</code>
          , the urge to rewrite the entire user command framework will
          be overwhelming - must not do that!) Thus I am stuck with a unportable
          configuration file that looks something like:
        </p>
        <pre>
          <code>{ 
  Settings: {
             Default_IO: 0,
             Default_ML: 3, 
             ClassicMode: 1,
             ClassicModeSavePosition: 1,
             SingleTrace: 1,
             AutoPW: 1, 
             SessionOnTop: 1,                          
             Log_Size: "8M",
             MaxWS: "8G",
             PropertyExposeRoot: 1,
             Load: "startup.apln",   
             SALT: {
                    CommandFolder: "c:/APLStartup/;[dyalog]/SALT/spice",                 
                   },
             Colours: {
                       SchemeName: "Back in Black",  
                      },
            }
}
</code>
        </pre>
        <p>We should be able to write something like:</p>
        <pre>
          <code>  SALT: {
            CommandFolder: "[configfolder];[dyalog]/SALT/spice",                 
        },
</code>
        </pre>
        <h2>Fixing and Executing Code on Startup</h2>
        <p>There are at least four ways to fix and excute code on startup:</p>
        <p>
          1. The user command framework using a
          <strong>setup.dyalog</strong>
          file.
        </p>
        <p>
          2. The
          <strong>DyalogStartup</strong>
          parameter.
        </p>
        <p>
          3. The
          <strong>DyalogStartupSE</strong>
          parameter.
        </p>
        <p>
          4. The
          <strong>Load</strong>
          (and
          <strong>LX</strong>
          ) configuration parameter.
        </p>
        <p>
          Option 1 requires placing setup.dyalog in a specific place, this
          is a no go. Option 2 requires highjacking LINK, and the DyalogStartupSE
          parameter which we probably don't want to do. Option 3 requires
          either putting code in some specific place that dyalog knows
          about or specifying a fully qualified path. Furthermore, there
          is a heirarchy of folders that are searched, which may be too
          clever by half, and lead to a lot of confusion. That leaves Option
          4, the
          <code>Load</code>
          parameter. Luckily it respects relative paths, and will look
          in the same location as the config file. The code can expunge
          itself after executing, and not clutter the root or introduce
          a name conflict. Here, for example, is a very simple startup
          routine that increases the font size, and specifies that the
          session window should be maximized:
        </p>
        <pre>
          <code>:Namespace startup
     ⎕SE.FontObj[1]←28
     ⎕SE.State←2
     Run←{
         #.⎕EX 'startup'
     }
:EndNamespace
</code>
        </pre>
        <p>Of course we could do much more here, like set PFKeys, load
        code into ⎕SE, mess around with menus, etc.</p>
        <p>
          It is not clear to me what precisely Dyalog envisioned as use-cases
          for the
          <code>Load</code>
          parameter. It accepts, workspaces, functions, namespace and class
          scripts and even, new in 18.2, a folder that is then automatically
          LINKed. For developement purposes, it seems ideal to use
          <code>Load</code>
          for session configuration.
        </p>
      </article>
      <article>
        <header>
          <h1>
            <a href="/posts/a-new-workspace-file-format">A New Workspace
            File Format</a>
          </h1>
          <h2>February 26, 2022</h2>
        </header>
        <p>
          I have documented how namespace scripts are a
          <a href="/posts/building-namespace-scripts">practical and efficient</a>
          way to store and transport source code. I have also documented
          that
          <a href="/posts/the-problem-with-namespace-scripts">they have
          problems</a>
          that prevent using them to their full potential.
        </p>
        <p>When we are able to define both scripted and unscripted namespaces,
        and when we are able to define the root namespace, all in a script,
        many very useful possibilites follow effortlessly.</p>
        <p>
          First the Dyalog interpreter should be able to simply open a
          script that defines the root. Thus if we have a simple text file
          <code>myworksapce.apln</code>
          :
        </p>
        <pre>
          <code>:Namespace #
   ⎕IO←0
   A←⍳10
   :Namespace MySpace 
   :Type unscripted
       f←{+/⍵}
   :EndNamespace 
:EndNamespace
</code>
        </pre>
        <p>Then in the session all we need to do is:</p>
        <pre>
          <code>      )load myworkspace.apln
</code>
        </pre>
        <p>
          In other words, we have a new, non-binary file format for the
          workspace. Furthermore, it zips up very well, so we could have,
          say,
          <code>.dwsx</code>
          files that are compressed text versions of dws files, analagous
          to Microsoft Excel
          <code>.xls</code>
          and
          <code>.xlsx</code>
          files. (In my sample, a 13 MB binary workspace is 750 KB as compressed
          text.)
        </p>
        <p>
          All sorts of possibilites arise with a zipped
          <code>.dwsx</code>
          file format, as it can contain, like
          <code>.xlsx</code>
          files, multiple files and folders. For example, it could contain
          a
          <a href="https://help.dyalog.com/18.0/#UserGuide/Installation%20and%20Configuration/Configuration%20Files.htm#Configuration_Files">configuration
          file</a>
          . It could have multiple namespace scripts and only load and
          fix code on demand.
        </p>
        <p>
          A
          <code>.dwsx</code>
          would probably not be appropriate for developement, as it would
          have the same drawbacks as a binary
          <code>.dws</code>
          file, but for sharing code, transport and application distribution
          it may be ideal. A non-zipped
          <code>.apln</code>
          file, however, may be quite useful for development: Open a clear
          workspace, start coding,
          <code>)saveastext</code>
          and have a text file representation of the workspace.
        </p>
      </article>
      <article>
        <header>
          <h1>
            <a href="/posts/aaronhsuquote">Aaron Hsu at Function Conf 2022</a>
          </h1>
          <h4>January 27, 2022</h4>
        </header>
        <p>
          Aaron Hsu is giving a
          <a href="https://confengine.com/conferences/functional-conf-2022/speaker/interview/aaron-w-hsu?utm_source=twitter&amp;utm_medium=organic_social&amp;utm_campaign=FnConf-speaker-profiles">talk
          at Functional conference 2022</a>
        </p>
        <p>In the interview Aaron says:</p>
        <blockquote>
          <p>More is accomplished by understanding the whole, than optimizing
          the part.</p>
        </blockquote>
        <p>That is a first class aphorism.</p>
        <p>
          It reminded me of the saying
          <em>premature optimization is the root of all evil</em>
          , I think extracted from the full Donald Knuth quote:
        </p>
        <blockquote>
          <p>The real problem is that programmers have spent far too much
          time worrying about efficiency in the wrong places and at the
          wrong times; premature optimization is the root of all evil (or
          at least most of it) in programming</p>
        </blockquote>
        <p>Aaron's formulation says more with less; it has a positive outlook.</p>
        <p>Looking forward to seeing his presentation.</p>
      </article>
      <h2>
        <a href="/posts">More posts...</a>
      </h2>
    </main>
    <footer>
      <p>Copyright 2021 Paul S. Mansour</p>
    </footer>
  </body>
</html>
