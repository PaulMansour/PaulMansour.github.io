<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"></meta>
    <meta content="width=device-width, initial-scale=1" name="viewport"></meta>
    <link href="/ThorntonMelon.css" rel="stylesheet"></link>
  </head>
  <body>
    <header>
      <h1>Tool of Thought</h1>
      <h2>APL for the Practical Man</h2>
      <nav>
        <a href="/">Home</a>
        <a href="/posts">Posts</a>
        <a href="/projects">Projects</a>
        <a href="/donts">Don'ts</a>
        <a href="/links">Links</a>
        <a href="/about">About</a>
      </nav>
    </header>
    <main>
      <article>
        <header>
          <h1>
            <a href="/posts/on-categorical-data">On Categorical Data</a>
          </h1>
          <h2>December 6, 2023</h2>
        </header>
        <p>Consider getting a useful first impression and understanding of a single column in a database table, (or a vector of values all of the same type). If there are only a few unique values in the column, say a dozen or less, then a frequency distribution is appropriate. We get an immediate, informative overview of the data, regardless of the type. This is easily displayed in a bar chart. Here we have the distribution of <em>stints</em> for major league baseball players in 2019. A stint is a period of time with a particular team. We can see that most players spent the entire season with one team, while 12 players played for 3 teams:  </p>
        <svg baseProfile="full" ev="http://www.w3.org/2001/xml-events" height="262.67" version="1.1" viewBox="0 0 6290 1970" width="838.67" xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg">
          <desc>Created by Causeway SVG engine - SharpPlot v3.71.0</desc>
          <g stroke-miterlimit="100">
            <rect fill="silver" height="1910" width="6210" x="80" y="60"></rect>
            <rect fill="white" height="1905" stroke="black" stroke-width="5" width="6205" x="43" y="33"></rect>
            <desc>Paint the paper =====</desc>
            <g fill="White">
              <rect height="1900" width="6200" x="45" y="35"></rect>
            </g>
            <desc>Border =====</desc>
            <desc>for X-axis labels</desc>
            <g font-family="Times New Roman" font-size="140" text-anchor="middle">
              <text x="1263" y="1646">200</text>
              <text x="1870" y="1646">400</text>
              <text x="2476" y="1646">600</text>
              <text x="3083" y="1646">800</text>
              <text x="3689" y="1646">1,000</text>
              <text x="4295" y="1646">1,200</text>
              <text x="4902" y="1646">1,400</text>
            </g>
            <desc>Heading, subheading and footnotes =====</desc>
            <desc>Region =====</desc>
            <desc>Y-axis labels</desc>
            <g font-family="Times New Roman" font-size="140" text-anchor="end">
              <text x="525" y="1265">3</text>
              <text x="525" y="925">2</text>
              <text x="525" y="585">1</text>
            </g>
            <desc>X-Axis Ticks =====</desc>
            <desc>X-Axis tickmarks</desc>
            <path d="M661 1456L661 1505M960 1456L960 1505M1263 1456L1263 1505M1567 1456L1567 1505M1870 1456L1870 1505M2173 1456L2173 1505M2476 1456L2476 1505M2779 1456L2779 1505M3083 1456L3083 1505M3386 1456L3386 1505M3689 1456L3689 1505M3992 1456L3992 1505M4295 1456L4295 1505M4599 1456L4599 1505M4902 1456L4902 1505M5205 1456L5205 1505" fill="none" stroke="DarkGray" stroke-width="8.94"></path>
            <desc>Y-Axis Ticks =====</desc>
            <desc>Y-Axis tickmarks</desc>
            <path d="M596 1221L559 1221M596 885L559 885M596 545L559 545" fill="none" stroke="DarkGray" stroke-width="8.94"></path>
            <desc>Start of Horizontal Barchart ===========</desc>
            <g fill="SteelBlue">
              <rect height="272" onclick="sendAPLRequest(event)" pointer-events="visible" width="36" x="657" y="1089"></rect>
              <rect height="272" onclick="sendAPLRequest(event)" pointer-events="visible" width="443" x="657" y="749"></rect>
              <rect height="272" onclick="sendAPLRequest(event)" pointer-events="visible" width="4275" x="657" y="409"></rect>
            </g>
            <desc>Axes =====</desc>
            <path d="M596 1395L596 368M657 1456L5212 1456" fill="none" stroke="DarkGray" stroke-width="14.9"></path>
            <desc>Data value labels ...</desc>
            <g fill="Gray" font-family="Times New Roman" font-size="140">
              <text x="750" y="1281">12</text>
              <text x="1156" y="941">146</text>
              <text x="4989" y="601">1,410</text>
            </g>
            <desc>Reset to original origin</desc>
          </g>
        </svg>
        <p>However, as the number of unique values grows, a frequency distribution becomes less and less useful. When every value is unique, the distribution degenerates into the entire original column catenated with a vector of 1's. For quantitative or temporal data, this problem is easily solved by grouping into  bins or buckets, reducing the number of categories. Here we have the number of games played per player for 2019: </p>
        <svg baseProfile="full" ev="http://www.w3.org/2001/xml-events" height="502.67" version="1.1" viewBox="0 0 6290 3770" width="838.67" xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg">
          <desc>Created by Causeway SVG engine - SharpPlot v3.71.0</desc>
          <g stroke-miterlimit="100">
            <rect fill="silver" height="3710" width="6210" x="80" y="60"></rect>
            <rect fill="white" height="3705" stroke="black" stroke-width="5" width="6205" x="43" y="33"></rect>
            <desc>Paint the paper =====</desc>
            <g fill="White">
              <rect height="3700" width="6200" x="45" y="35"></rect>
            </g>
            <desc>Border =====</desc>
            <desc>for X-axis labels</desc>
            <g font-family="Times New Roman" font-size="140" text-anchor="middle">
              <text x="1527" y="3446">50</text>
              <text x="1862" y="3446">100</text>
              <text x="2196" y="3446">150</text>
              <text x="2530" y="3446">200</text>
              <text x="2865" y="3446">250</text>
              <text x="3199" y="3446">300</text>
              <text x="3533" y="3446">350</text>
              <text x="3868" y="3446">400</text>
              <text x="4202" y="3446">450</text>
              <text x="4536" y="3446">500</text>
              <text x="4871" y="3446">550</text>
              <text x="5205" y="3446">600</text>
            </g>
            <desc>Heading, subheading and footnotes =====</desc>
            <desc>Region =====</desc>
            <desc>Y-axis labels</desc>
            <g font-family="Times New Roman" font-size="140" text-anchor="end">
              <text x="1061" y="3078">160&nbsp;to&nbsp;179</text>
              <text x="1061" y="2765">140&nbsp;to&nbsp;159</text>
              <text x="1061" y="2452">120&nbsp;to&nbsp;139</text>
              <text x="1061" y="2138">100&nbsp;to&nbsp;119</text>
              <text x="1061" y="1825">80&nbsp;to&nbsp;99</text>
              <text x="1061" y="1512">60&nbsp;to&nbsp;79</text>
              <text x="1061" y="1198">40&nbsp;to&nbsp;59</text>
              <text x="1061" y="885">20&nbsp;to&nbsp;39</text>
              <text x="1061" y="572">0&nbsp;to&nbsp;19</text>
            </g>
            <desc>X-Axis Ticks =====</desc>
            <desc>X-Axis tickmarks</desc>
            <path d="M1197 3256L1197 3305M1527 3256L1527 3305M1862 3256L1862 3305M2196 3256L2196 3305M2530 3256L2530 3305M2865 3256L2865 3305M3199 3256L3199 3305M3533 3256L3533 3305M3868 3256L3868 3305M4202 3256L4202 3305M4536 3256L4536 3305M4871 3256L4871 3305M5205 3256L5205 3305" fill="none" stroke="DarkGray" stroke-width="8.94"></path>
            <desc>Y-Axis Ticks =====</desc>
            <desc>Y-Axis tickmarks</desc>
            <path d="M1132 3034L1095 3034M1132 2725L1095 2725M1132 2412L1095 2412M1132 2098L1095 2098M1132 1785L1095 1785M1132 1472L1095 1472M1132 1158L1095 1158M1132 845L1095 845M1132 532L1095 532" fill="none" stroke="DarkGray" stroke-width="8.94"></path>
            <desc>Start of Horizontal Barchart ===========</desc>
            <g fill="SteelBlue">
              <rect height="251" onclick="sendAPLRequest(event)" pointer-events="visible" width="74" x="1193" y="2913"></rect>
              <rect height="251" onclick="sendAPLRequest(event)" pointer-events="visible" width="562" x="1193" y="2600"></rect>
              <rect height="251" onclick="sendAPLRequest(event)" pointer-events="visible" width="542" x="1193" y="2286"></rect>
              <rect height="251" onclick="sendAPLRequest(event)" pointer-events="visible" width="401" x="1193" y="1973"></rect>
              <rect height="251" onclick="sendAPLRequest(event)" pointer-events="visible" width="522" x="1193" y="1660"></rect>
              <rect height="251" onclick="sendAPLRequest(event)" pointer-events="visible" width="916" x="1193" y="1346"></rect>
              <rect height="251" onclick="sendAPLRequest(event)" pointer-events="visible" width="1077" x="1193" y="1033"></rect>
              <rect height="251" onclick="sendAPLRequest(event)" pointer-events="visible" width="2614" x="1193" y="720"></rect>
              <rect height="251" onclick="sendAPLRequest(event)" pointer-events="visible" width="3778" x="1193" y="406"></rect>
            </g>
            <desc>Axes =====</desc>
            <path d="M1132 3195L1132 368M1193 3256L5212 3256" fill="none" stroke="DarkGray" stroke-width="14.9"></path>
            <desc>Data value labels ...</desc>
            <g fill="Gray" font-family="Times New Roman" font-size="140">
              <text x="1323" y="3095">11</text>
              <text x="1811" y="2781">84</text>
              <text x="1791" y="2468">81</text>
              <text x="1651" y="2155">60</text>
              <text x="1771" y="1841">78</text>
              <text x="2165" y="1528">137</text>
              <text x="2326" y="1215">161</text>
              <text x="3864" y="901">391</text>
              <text x="5027" y="588">565</text>
            </g>
            <desc>Reset to original origin</desc>
          </g>
        </svg>
        <p>However, if the data is categorical, it is generally not possible to meaningfully group the data. One option is to produce a frequency distribution that shows only the top 10 (say) categories, grouping the remainder into an "other" category. This works well when there are many categories, and the categories are of varying sizes, keeping the "other" category relatively small:</p>
        <svg baseProfile="full" ev="http://www.w3.org/2001/xml-events" height="582.67" version="1.1" viewBox="0 0 6290 4370" width="838.67" xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg">
          <desc>Created by Causeway SVG engine - SharpPlot v3.71.0</desc>
          <g stroke-miterlimit="100">
            <rect fill="silver" height="4310" width="6210" x="80" y="60"></rect>
            <rect fill="white" height="4305" stroke="black" stroke-width="5" width="6205" x="43" y="33"></rect>
            <desc>Paint the paper =====</desc>
            <g fill="White">
              <rect height="4300" width="6200" x="45" y="35"></rect>
            </g>
            <desc>Border =====</desc>
            <desc>for X-axis labels</desc>
            <g font-family="Times New Roman" font-size="140" text-anchor="middle">
              <text x="1817" y="4046">500</text>
              <text x="2240" y="4046">1,000</text>
              <text x="2664" y="4046">1,500</text>
              <text x="3087" y="4046">2,000</text>
              <text x="3511" y="4046">2,500</text>
              <text x="3934" y="4046">3,000</text>
              <text x="4358" y="4046">3,500</text>
              <text x="4781" y="4046">4,000</text>
              <text x="5205" y="4046">4,500</text>
            </g>
            <desc>Heading, subheading and footnotes =====</desc>
            <desc>Region =====</desc>
            <desc>Y-axis labels</desc>
            <g font-family="Times New Roman" font-size="140" text-anchor="end">
              <text x="1261" y="3680">Other</text>
              <text x="1261" y="3369">Moseley</text>
              <text x="1261" y="3058">Crozet</text>
              <text x="1261" y="2747">Suffolk</text>
              <text x="1261" y="2436">Chesapeake</text>
              <text x="1261" y="2125">Clarksville</text>
              <text x="1261" y="1814">Chesterfield</text>
              <text x="1261" y="1503">Midlothian</text>
              <text x="1261" y="1192">Charlottesville</text>
              <text x="1261" y="881">Virginia&nbsp;Beach</text>
              <text x="1261" y="570">Richmond</text>
            </g>
            <desc>X-Axis Ticks =====</desc>
            <desc>X-Axis tickmarks</desc>
            <path d="M1397 3856L1397 3905M1817 3856L1817 3905M2240 3856L2240 3905M2664 3856L2664 3905M3087 3856L3087 3905M3511 3856L3511 3905M3934 3856L3934 3905M4358 3856L4358 3905M4781 3856L4781 3905M5205 3856L5205 3905" fill="none" stroke="DarkGray" stroke-width="8.94"></path>
            <desc>Y-Axis Ticks =====</desc>
            <desc>Y-Axis tickmarks</desc>
            <path d="M1332 3635L1295 3635M1332 3329L1295 3329M1332 3018L1295 3018M1332 2707L1295 2707M1332 2396L1295 2396M1332 2085L1295 2085M1332 1774L1295 1774M1332 1463L1295 1463M1332 1152L1295 1152M1332 841L1295 841M1332 530L1295 530" fill="none" stroke="DarkGray" stroke-width="8.94"></path>
            <desc>Start of Horizontal Barchart ===========</desc>
            <g fill="SteelBlue">
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="3812" x="1393" y="3515"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="85" x="1393" y="3204"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="169" x="1393" y="2893"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="169" x="1393" y="2582"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="169" x="1393" y="2272"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="169" x="1393" y="1961"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="339" x="1393" y="1650"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="424" x="1393" y="1339"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="424" x="1393" y="1028"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="932" x="1393" y="717"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="1779" x="1393" y="406"></rect>
            </g>
            <desc>Axes =====</desc>
            <path d="M1332 3795L1332 368M1393 3856L5212 3856" fill="none" stroke="DarkGray" stroke-width="14.9"></path>
            <desc>Data value labels ...</desc>
            <g fill="Gray" font-family="Times New Roman" font-size="140">
              <text x="5261" y="3696">4,500</text>
              <text x="1534" y="3385">100</text>
              <text x="1619" y="3074">200</text>
              <text x="1619" y="2763">200</text>
              <text x="1619" y="2452">200</text>
              <text x="1619" y="2141">200</text>
              <text x="1788" y="1830">400</text>
              <text x="1873" y="1520">500</text>
              <text x="1873" y="1209">500</text>
              <text x="2381" y="898">1,100</text>
              <text x="3228" y="587">2,100</text>
            </g>
            <desc>Reset to original origin</desc>
          </g>
        </svg>
        <p>If there are many categories and they are similar-sized, this breaks down. Here we have a distribution of the <code>PlayerID</code> column, which is mostly unique, except for  players that have done multiple stints in the season:</p>
        <svg baseProfile="full" ev="http://www.w3.org/2001/xml-events" height="582.67" version="1.1" viewBox="0 0 6290 4370" width="838.67" xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg">
          <desc>Created by Causeway SVG engine - SharpPlot v3.71.0</desc>
          <g stroke-miterlimit="100">
            <rect fill="silver" height="4310" width="6210" x="80" y="60"></rect>
            <rect fill="white" height="4305" stroke="black" stroke-width="5" width="6205" x="43" y="33"></rect>
            <desc>Paint the paper =====</desc>
            <g fill="White">
              <rect height="4300" width="6200" x="45" y="35"></rect>
            </g>
            <desc>Border =====</desc>
            <desc>for X-axis labels</desc>
            <g font-family="Times New Roman" font-size="140" text-anchor="middle">
              <text x="1751" y="4046">200</text>
              <text x="2244" y="4046">400</text>
              <text x="2738" y="4046">600</text>
              <text x="3231" y="4046">800</text>
              <text x="3725" y="4046">1,000</text>
              <text x="4218" y="4046">1,200</text>
              <text x="4712" y="4046">1,400</text>
              <text x="5205" y="4046">1,600</text>
            </g>
            <desc>Heading, subheading and footnotes =====</desc>
            <desc>Region =====</desc>
            <desc>Y-axis labels</desc>
            <g font-family="Times New Roman" font-size="140" text-anchor="end">
              <text x="1125" y="3680">Other</text>
              <text x="1125" y="3369">mejiaad01</text>
              <text x="1125" y="3058">maldoma01</text>
              <text x="1125" y="2747">josepco01</text>
              <text x="1125" y="2436">fontwi01</text>
              <text x="1125" y="2125">dullry01</text>
              <text x="1125" y="1814">darnatr01</text>
              <text x="1125" y="1503">broxtke01</text>
              <text x="1125" y="1192">biddlje01</text>
              <text x="1125" y="881">austity01</text>
              <text x="1125" y="570">altheaa01</text>
            </g>
            <desc>X-Axis Ticks =====</desc>
            <desc>X-Axis tickmarks</desc>
            <path d="M1261 3856L1261 3905M1504 3856L1504 3905M1751 3856L1751 3905M1997 3856L1997 3905M2244 3856L2244 3905M2491 3856L2491 3905M2738 3856L2738 3905M2984 3856L2984 3905M3231 3856L3231 3905M3478 3856L3478 3905M3725 3856L3725 3905M3971 3856L3971 3905M4218 3856L4218 3905M4465 3856L4465 3905M4712 3856L4712 3905M4958 3856L4958 3905M5205 3856L5205 3905" fill="none" stroke="DarkGray" stroke-width="8.94"></path>
            <desc>Y-Axis Ticks =====</desc>
            <desc>Y-Axis tickmarks</desc>
            <path d="M1196 3635L1159 3635M1196 3329L1159 3329M1196 3018L1159 3018M1196 2707L1159 2707M1196 2396L1159 2396M1196 2085L1159 2085M1196 1774L1159 1774M1196 1463L1159 1463M1196 1152L1159 1152M1196 841L1159 841M1196 530L1159 530" fill="none" stroke="DarkGray" stroke-width="8.94"></path>
            <desc>Start of Horizontal Barchart ===========</desc>
            <g fill="SteelBlue">
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="3795" x="1257" y="3515"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="7" x="1257" y="3204"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="7" x="1257" y="2893"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="7" x="1257" y="2582"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="7" x="1257" y="2272"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="7" x="1257" y="1961"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="7" x="1257" y="1650"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="7" x="1257" y="1339"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="7" x="1257" y="1028"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="7" x="1257" y="717"></rect>
              <rect height="249" onclick="sendAPLRequest(event)" pointer-events="visible" width="7" x="1257" y="406"></rect>
            </g>
            <desc>Axes =====</desc>
            <path d="M1196 3795L1196 368M1257 3856L5212 3856" fill="none" stroke="DarkGray" stroke-width="14.9"></path>
            <desc>Data value labels ...</desc>
            <g fill="Gray" font-family="Times New Roman" font-size="140">
              <text x="5108" y="3696">1,538</text>
              <text x="1321" y="3385">3</text>
              <text x="1321" y="3074">3</text>
              <text x="1321" y="2763">3</text>
              <text x="1321" y="2452">3</text>
              <text x="1321" y="2141">3</text>
              <text x="1321" y="1830">3</text>
              <text x="1321" y="1520">3</text>
              <text x="1321" y="1209">3</text>
              <text x="1321" y="898">3</text>
              <text x="1321" y="587">3</text>
            </g>
            <desc>Reset to original origin</desc>
          </g>
        </svg>
        <p>What, then, is to be done in the case of a categorical column with many evenly distributed unique values? If a frequency distribution is inadequate how about a frequency distribution of the frequency distribution? That is, a table displaying the number of values that occur once, the number of values that occur twice, the number of values that occur three times, etc.: </p>
        <table>
          <thead>
            <tr><th class="left">Value Occurs</th><th class="right">Unique Count</th><th class="right">Total Rows</th></tr>
          </thead>
          <tbody>
            <tr><td class="left">Once</td><td class="right">1,264</td><td class="right">1,264</td></tr>
            <tr><td class="left">Twice</td><td class="right">134</td><td class="right">268</td></tr>
            <tr><td class="left">Three times</td><td class="right">12</td><td class="right">36</td></tr>
            <tr><td class="left">Four times</td><td class="right">0</td><td class="right">0</td></tr>
            <tr><td class="left">Five +</td><td class="right">0</td><td class="right">0</td></tr>
            <tr><td class="left">Total</td><td class="right">1,410</td><td class="right">1,568</td></tr>
          </tbody>
        </table>
        <p>This table is a much more useful first look at <strong>high-variance categorical</strong> data.  For example, it is immediately apparent if the values are unique and suitable for a key column. It is easy to identify outliers, that is duplicate values or triplicate values. Let's call this a <em>second-order</em> frequency distribution.  </p>
        <p>By inspection we can tell whether a first-order or second-order distribution will be more useful, and come up with some back-of-the-envelope algorithm to make the choice, which may well be sufficient. But is there a way to actually compute the variance of a categorical column and  use that measure to determine what exactly is "high-variance" categorical data?   That question and some APL code will be explored in the next post.    </p>
      </article>
      <article>
        <header>
          <h1>
            <a href="/posts/high-rank-arrays">High-Rank Arrays</a>
          </h1>
          <h2>November 15, 2023</h2>
        </header>
        <p>A <a href="https://www.arraycast.com/episodes/episode66-tali-beynon">recent episode</a> of Array Cast discussed high-rank arrays and the concept of named axes. (I vaguely remembered that Brother Steve had done a paper on this very topic some 20 odd years ago, and sure enough <a href="https://dl.acm.org/doi/10.1145/570475.570494">he did</a>.)   One use or application of high-rank arrays covered in the podcast was essentially multidimensional OLAP. That is, the construction of high rank arrays from some other source, usually a relational database, precomputing ranges, bins, categories and various measures. For example, in some health care application, you might end up with a rank 6 array that contains record counts by age, sex, marital status, income range, smoker, and drinks-per-day. This application of high-rank arrays is a very bad idea, that has been around a long time, and like many bad ideas, refuses to die.</p>
        <p>Voluminous books have been written, endless jargon coined, complex software designed, and vast fortunes made consulting, all selling this bill of goods. All because SQL is viewed as virtually synonymous with the relational database model, and the vast majority of commercial RDBMS implementations use row-based storage. In other words, it's hard and time consuming to write analytic queries that require full table scans in Oracle or SQL Server, and then they run slow. This is no reason to jettison the relational database model.</p>
        <p>The name "multidimensional" in this context is completely misleading. It implies that the relational model is somehow not multidimensional. But of course it is. The very fact that an OLAP "data cube" can be constructed from  a single relational database table proves this. It is true that a table or matrix has two dimensions, rows and columns. But it is also true that a vector of length n represents a point in n-space. And a matrix is just a collection of row vectors, or a collection of points in n-space.  So what then is a matrix? Is it a two dimensional thing or an n-dimensional thing? The answer is that it is both, often at the same time; it simply depends on what's in it, and how we interpret it. But whatever is in it, and however we interpret it, it never ever makes sense to explode the thing into a high-rank array, taking a lot of time and trouble in the process, losing tons of information along the way, and blowing out your workspace to boot.</p>
        <p>Also discussed in the podcast was another idea, at best equally bad, probably worse; high-depth arrays and dependent types as an alternative to the relational model. The example presented was storing data about planets and their moons, where a table of planets has a moons column that contains nested tables of moons for each planet. This leads to more complexity, more difficulty in querying, more problems in efficient storage, and all sorts of other problems. Imagine you then want to store the elements that have been found on each moon. You can see where that leads, and it's no where good. The relational model solved this problem simply and elegantly something like 60 years ago. </p>
        <p>With the right design (column oriented), and a query language based on APL, the relational model is the right way to organize your data in the examples above. Like the core concepts of APL, the relational model cannot be improved upon.  High-rank arrays and nested tables are useful and appropriate in some cases, but not here.         </p>
        <p> </p>
        <p>    </p>
      </article>
      <article>
        <header>
          <h1>
            <a href="/posts/charting-and-tidy-data">Charting and Tidy Data</a>
          </h1>
          <h2>September 28, 2023</h2>
        </header>
        <p><a href="https://vita.had.co.nz/papers/tidy-data.pdf">Tidy data</a> is mostly just an informal term for what in database theory is called 3rd (or there abouts) normal form. If data is not <em>tidy</em>, it is considered <em>messy</em>. Another pair of terms for the same concept, but less judgmental, is <em>long-form</em> and <em>wide-form</em>.  Often wide-form or messy data is simply report data or secondary data. That is, it is the result of some report generated from the primary data in a DBMS. "Messy" in this case is in the eye of the beholder. Long-form data can also be composed of secondary data; it can be the result of a grouped query for example.</p>
        <p><a href="https://altair-viz.github.io/user_guide/data.html#long-form-vs-wide-form-data">Altair</a> strongly prefers long-form data, while <a href="https://plotly.com/python/wide-form/">plotly</a> is happy to handle either format. </p>
        <p>To explore this issue with SharpPlot we will use the well known 1930's barley experiment data set, beloved by statisticians. The data ranges over 6 farms, 10 varieties of barley, and 2 years, for a total of 120 observations on yields. Here are the first 10 rows:</p>
        <table>
          <thead>
            <tr><th class="right">Year  </th><th class="left">Farm             </th><th class="left">Variety           </th><th class="right">Yield  </th></tr>
          </thead>
          <tbody>
            <tr><td class="right"><code>1931</code></td><td class="left"><code>University Farm</code></td><td class="left"><code>Manchuria</code>       </td><td class="right"><code>27.00</code></td></tr>
            <tr><td class="right"><code>1931</code></td><td class="left"><code>Waseca</code>         </td><td class="left"><code>Manchuria</code>       </td><td class="right"><code>48.87</code></td></tr>
            <tr><td class="right"><code>1931</code></td><td class="left"><code>Morris</code>         </td><td class="left"><code>Manchuria</code>       </td><td class="right"><code>27.43</code></td></tr>
            <tr><td class="right"><code>1931</code></td><td class="left"><code>Crookston</code>      </td><td class="left"><code>Manchuria</code>       </td><td class="right"><code>39.93</code></td></tr>
            <tr><td class="right"><code>1931</code></td><td class="left"><code>Grand Rapids</code>   </td><td class="left"><code>Manchuria</code>       </td><td class="right"><code>32.97</code></td></tr>
            <tr><td class="right"><code>1931</code></td><td class="left"><code>Duluth</code>         </td><td class="left"><code>Manchuria</code>       </td><td class="right"><code>28.97</code></td></tr>
            <tr><td class="right"><code>1931</code></td><td class="left"><code>University Farm</code></td><td class="left"><code>Glabron</code>         </td><td class="right"><code>43.07</code></td></tr>
            <tr><td class="right"><code>1931</code></td><td class="left"><code>Waseca</code>         </td><td class="left"><code>Glabron</code>         </td><td class="right"><code>55.20</code></td></tr>
            <tr><td class="right"><code>1931</code></td><td class="left"><code>Morris</code>         </td><td class="left"><code>Glabron</code>         </td><td class="right"><code>28.77</code></td></tr>
            <tr><td class="right"><code>1931</code></td><td class="left"><code>Crookston</code>      </td><td class="left"><code>Glabron</code>         </td><td class="right"><code>38.13</code></td></tr>
          </tbody>
        </table>
        <p>Consider now aggregating the yield for farm and year, effectively eliminating the variety column. We can compute and display this as a multi-level grouping, grouping by the unique combinations of year and farm, and summing the yields: </p>
        <table>
          <thead>
            <tr><th class="right">Year  </th><th class="left">Farm             </th><th class="right">Yield   </th></tr>
          </thead>
          <tbody>
            <tr><td class="right"><code>1931</code></td><td class="left"><code>University Farm</code></td><td class="right"><code>358.28</code></td></tr>
            <tr><td class="right"><code>1931</code></td><td class="left"><code>Waseca</code>         </td><td class="right"><code>543.47</code></td></tr>
            <tr><td class="right"><code>1931</code></td><td class="left"><code>Morris</code>         </td><td class="right"><code>292.88</code></td></tr>
            <tr><td class="right"><code>1931</code></td><td class="left"><code>Crookston</code>      </td><td class="right"><code>436.60</code></td></tr>
            <tr><td class="right"><code>1931</code></td><td class="left"><code>Grand Rapids</code>   </td><td class="right"><code>290.54</code></td></tr>
            <tr><td class="right"><code>1931</code></td><td class="left"><code>Duluth</code>         </td><td class="right"><code>302.94</code></td></tr>
            <tr><td class="right"><code>1932</code></td><td class="left"><code>University Farm</code></td><td class="right"><code>295.07</code></td></tr>
            <tr><td class="right"><code>1932</code></td><td class="left"><code>Waseca</code>         </td><td class="right"><code>418.70</code></td></tr>
            <tr><td class="right"><code>1932</code></td><td class="left"><code>Morris</code>         </td><td class="right"><code>415.12</code></td></tr>
            <tr><td class="right"><code>1932</code></td><td class="left"><code>Crookston</code>      </td><td class="right"><code>311.79</code></td></tr>
            <tr><td class="right"><code>1932</code></td><td class="left"><code>Grand Rapids</code>   </td><td class="right"><code>208.09</code></td></tr>
            <tr><td class="right"><code>1932</code></td><td class="left"><code>Duluth</code>         </td><td class="right"><code>257.01</code></td></tr>
          </tbody>
        </table>
        <p>This is long-form data (despite being the result of a query). We can also compute and present the same data as a crosstab of yields by farm and year:</p>
        <table>
          <thead>
            <tr><th class="left">Farm             </th><th class="right">1931    </th><th class="right">1932    </th></tr>
          </thead>
          <tbody>
            <tr><td class="left"><code>University Farm</code></td><td class="right"><code>358.28</code></td><td class="right"><code>295.07</code></td></tr>
            <tr><td class="left"><code>Waseca</code>         </td><td class="right"><code>543.47</code></td><td class="right"><code>418.70</code></td></tr>
            <tr><td class="left"><code>Morris</code>         </td><td class="right"><code>292.88</code></td><td class="right"><code>415.12</code></td></tr>
            <tr><td class="left"><code>Crookston</code>      </td><td class="right"><code>436.60</code></td><td class="right"><code>311.79</code></td></tr>
            <tr><td class="left"><code>Grand Rapids</code>   </td><td class="right"><code>290.54</code></td><td class="right"><code>208.09</code></td></tr>
            <tr><td class="left"><code>Duluth</code>         </td><td class="right"><code>302.94</code></td><td class="right"><code>257.01</code></td></tr>
          </tbody>
        </table>
        <p>This is wide-form data. In this particular case, we have the same number of columns, but if we had more years of data, the crosstab would get wider, and of course the multi-level grouping in long-form would get longer.</p>
        <p>In the case of a bar chart, SharpPlot accepts the wide form data with a minimum of fuss. The <a href="https://sharpplot.com/SharpPlot-DrawBarChart.htm">DrawBarChart</a> method accepts a vector of vectors (in this case, one for year 1931 and one for the year 1932).    Playfair assumes the first column of data is the category and all remaining columns are  <code>y</code> axis or quantitative values so the chart definition for the wide-form data above is simply: </p>
        <pre><code>     p←##.Main.New''
     p.ChartType←'BarChart'
     p.Heading←'Barley Yields from Wide-Form Data'
     p
</code></pre>
        <p>and the result is:</p>
        <svg baseProfile="full" ev="http://www.w3.org/2001/xml-events" height="361.33" version="1.1" viewBox="0 0 4050 2710" width="540" xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg">
          <title>Barley Yields from Wide-Form Data</title>
          <desc>Created by Causeway SVG engine - SharpPlot v3.71.0</desc>
          <g stroke-miterlimit="100">
            <rect fill="silver" height="2650" width="3970" x="80" y="60"></rect>
            <rect fill="white" height="2645" stroke="black" stroke-width="5" width="3965" x="43" y="33"></rect>
            <desc>Paint the paper =====</desc>
            <g fill="White">
              <rect height="2640" width="3960" x="45" y="35"></rect>
            </g>
            <desc>Border =====</desc>
            <desc>Y-axis labels</desc>
            <g font-family="Times New Roman" font-size="80" text-anchor="end">
              <text x="318" y="2205">0</text>
              <text x="318" y="2050">50</text>
              <text x="318" y="1894">100</text>
              <text x="318" y="1739">150</text>
              <text x="318" y="1583">200</text>
              <text x="318" y="1428">250</text>
              <text x="318" y="1272">300</text>
              <text x="318" y="1117">350</text>
              <text x="318" y="961">400</text>
              <text x="318" y="806">450</text>
              <text x="318" y="650">500</text>
              <text x="318" y="495">550</text>
            </g>
            <desc>Heading, subheading and footnotes =====</desc>
            <desc>Heading</desc>
            <g fill="SteelBlue" font-family="Times New Roman" font-size="170" text-anchor="middle">
              <text x="2025" y="313">Barley Yields from Wide-Form Data</text>
            </g>
            <desc>Region =====</desc>
            <desc>for X-axis labels</desc>
            <g font-family="Times New Roman" font-size="80" text-anchor="middle">
              <text x="714" y="2361">University Farm</text>
              <text x="1273" y="2361">Waseca</text>
              <text x="1831" y="2361">Morris</text>
              <text x="2389" y="2361">Crookston</text>
              <text x="2948" y="2361">Grand Rapids</text>
              <text x="3506" y="2361">Duluth</text>
            </g>
            <desc>X-Axis Ticks =====</desc>
            <desc>X-Axis tickmarks</desc>
            <path d="M718 2238L718 2281M1273 2238L1273 2281M1831 2238L1831 2281M2389 2238L2389 2281M2948 2238L2948 2281M3506 2238L3506 2281" fill="none" stroke="DarkGray" stroke-width="6.83"></path>
            <desc>Y-Axis Ticks =====</desc>
            <desc>Y grid</desc>
            <path d="M435 2182L3785 2182M435 2030L3785 2030M435 1874L3785 1874M435 1719L3785 1719M435 1563L3785 1563M435 1408L3785 1408M435 1252L3785 1252M435 1097L3785 1097M435 941L3785 941M435 786L3785 786M435 630L3785 630M435 475L3785 475" fill="none" stroke="Silver" stroke-width="1.72"></path>
            <desc>Y-Axis tickmarks</desc>
            <path d="M382 2182L350 2182M382 2030L350 2030M382 1874L350 1874M382 1719L350 1719M382 1563L350 1563M382 1408L350 1408M382 1252L350 1252M382 1097L350 1097M382 941L350 941M382 786L350 786M382 630L350 630M382 475L350 475" fill="none" stroke="DarkGray" stroke-width="6.83"></path>
            <desc>Start of Barchart ===========</desc>
            <g fill="SteelBlue" stroke="Black" stroke-width="4">
              <rect height="1114" width="154" x="560" y="1071"></rect>
              <rect height="1690" width="154" x="1118" y="495"></rect>
              <rect height="911" width="154" x="1677" y="1274"></rect>
              <rect height="1357" width="154" x="2235" y="828"></rect>
              <rect height="903" width="154" x="2793" y="1282"></rect>
              <rect height="942" width="154" x="3352" y="1243"></rect>
            </g>
            <g fill="DarkOrange" stroke="Black" stroke-width="4">
              <rect height="917" width="154" x="714" y="1268"></rect>
              <rect height="1302" width="154" x="1273" y="883"></rect>
              <rect height="1291" width="154" x="1831" y="894"></rect>
              <rect height="969" width="154" x="2389" y="1216"></rect>
              <rect height="647" width="154" x="2948" y="1538"></rect>
              <rect height="799" width="154" x="3506" y="1386"></rect>
            </g>
            <desc>Axes =====</desc>
            <path d="M382 2185L382 469M435 2238L3791 2238" fill="none" stroke="DarkGray" stroke-width="11.4"></path>
            <desc>Key =====</desc>
            <desc>Block key</desc>
            <g fill="SteelBlue" stroke="Black" stroke-width="4">
              <rect height="63" width="153" x="525" y="2433"></rect>
            </g>
            <desc>Block key</desc>
            <g fill="DarkOrange" stroke="Black" stroke-width="4">
              <rect height="63" width="153" x="984" y="2433"></rect>
            </g>
            <g fill="Navy" font-family="Times New Roman" font-size="90">
              <text x="723" y="2496">1931</text>
            </g>
            <g fill="Navy" font-family="Times New Roman" font-size="90">
              <text x="1182" y="2496">1932</text>
            </g>
            <desc>Reset to original origin</desc>
          </g>
        </svg>
        <p>There is nothing wrong with wide-form data as a report format, or as the result of applying a query to long-form data, particularly when we are immediately using it as the input to a charting function, and particularly for bar charts. The wide-form data, like the bar chart we are creating, makes it easy to compare values between years. The long-form data is not conducive to this. Furthermore, we may well want to display the graph and the data side by side, and there is no reason to compute the values twice, once in the DBMS and once in the chart library.</p>
        <p>On the other hand, long-form data does not need placeholders for empty or missing or non-existent data. If there was no observation for Grand Rapids in 1931, the long-form data simply would not have this row. But the wide-form data needs a cell for it. This becomes important for scatter plots, where the x axis can have different values for different groups. We will explore this in a future post.     SharpPlot will also accept long-form data, but we must also specify the <a href="https://sharpplot.com/SharpPlot-GroupBy.htm">GroupBy</a> and <a href="https://sharpplot.com/SharpPlot-SplitBy.htm">SplitBy</a> methods.   While these are methods that take actual column values in SharpPlot, in Playfair we have converted them to properties that take the name of the column of the input table. Using the long-form data above we can define the chart as:</p>
        <pre><code>     p←##.Main.New''
     p.ChartType←'BarChart'
     p.Heading←'Barley Yields from Long-Form Data'
     p.Select←'Farm,Yield'
     p.GroupBy←'Farm'
     p.SplitBy←'Year'
</code></pre>
        <p>Note that in Playfair we must set a <code>Select</code> property to specify the columns for the axes, if the the table has more columns or the columns are not in the proper order for the default behavior. </p>
        <p>And this produces the exact same chart as the wide-form example:</p>
        <svg baseProfile="full" ev="http://www.w3.org/2001/xml-events" height="361.33" version="1.1" viewBox="0 0 4050 2710" width="540" xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg">
          <title>Barley Yields from Long-Form Data</title>
          <desc>Created by Causeway SVG engine - SharpPlot v3.71.0</desc>
          <g stroke-miterlimit="100">
            <rect fill="silver" height="2650" width="3970" x="80" y="60"></rect>
            <rect fill="white" height="2645" stroke="black" stroke-width="5" width="3965" x="43" y="33"></rect>
            <desc>Paint the paper =====</desc>
            <g fill="White">
              <rect height="2640" width="3960" x="45" y="35"></rect>
            </g>
            <desc>Border =====</desc>
            <desc>Y-axis labels</desc>
            <g font-family="Times New Roman" font-size="80" text-anchor="end">
              <text x="318" y="2205">0</text>
              <text x="318" y="2050">50</text>
              <text x="318" y="1894">100</text>
              <text x="318" y="1739">150</text>
              <text x="318" y="1583">200</text>
              <text x="318" y="1428">250</text>
              <text x="318" y="1272">300</text>
              <text x="318" y="1117">350</text>
              <text x="318" y="961">400</text>
              <text x="318" y="806">450</text>
              <text x="318" y="650">500</text>
              <text x="318" y="495">550</text>
            </g>
            <desc>Heading, subheading and footnotes =====</desc>
            <desc>Heading</desc>
            <g fill="SteelBlue" font-family="Times New Roman" font-size="170" text-anchor="middle">
              <text x="2025" y="313">Barley Yields from Long-Form Data</text>
            </g>
            <desc>Region =====</desc>
            <desc>for X-axis labels</desc>
            <g font-family="Times New Roman" font-size="80" text-anchor="middle">
              <text x="714" y="2361">University Farm</text>
              <text x="1273" y="2361">Waseca</text>
              <text x="1831" y="2361">Morris</text>
              <text x="2389" y="2361">Crookston</text>
              <text x="2948" y="2361">Grand Rapids</text>
              <text x="3506" y="2361">Duluth</text>
            </g>
            <desc>X-Axis Ticks =====</desc>
            <desc>X-Axis tickmarks</desc>
            <path d="M718 2238L718 2281M1273 2238L1273 2281M1831 2238L1831 2281M2389 2238L2389 2281M2948 2238L2948 2281M3506 2238L3506 2281" fill="none" stroke="DarkGray" stroke-width="6.83"></path>
            <desc>Y-Axis Ticks =====</desc>
            <desc>Y grid</desc>
            <path d="M435 2182L3785 2182M435 2030L3785 2030M435 1874L3785 1874M435 1719L3785 1719M435 1563L3785 1563M435 1408L3785 1408M435 1252L3785 1252M435 1097L3785 1097M435 941L3785 941M435 786L3785 786M435 630L3785 630M435 475L3785 475" fill="none" stroke="Silver" stroke-width="1.72"></path>
            <desc>Y-Axis tickmarks</desc>
            <path d="M382 2182L350 2182M382 2030L350 2030M382 1874L350 1874M382 1719L350 1719M382 1563L350 1563M382 1408L350 1408M382 1252L350 1252M382 1097L350 1097M382 941L350 941M382 786L350 786M382 630L350 630M382 475L350 475" fill="none" stroke="DarkGray" stroke-width="6.83"></path>
            <desc>Start of Barchart ===========</desc>
            <g fill="SteelBlue" stroke="Black" stroke-width="4">
              <rect height="1114" width="154" x="560" y="1071"></rect>
              <rect height="1690" width="154" x="1118" y="495"></rect>
              <rect height="911" width="154" x="1677" y="1274"></rect>
              <rect height="1357" width="154" x="2235" y="828"></rect>
              <rect height="903" width="154" x="2793" y="1282"></rect>
              <rect height="942" width="154" x="3352" y="1243"></rect>
            </g>
            <g fill="DarkOrange" stroke="Black" stroke-width="4">
              <rect height="917" width="154" x="714" y="1268"></rect>
              <rect height="1302" width="154" x="1273" y="883"></rect>
              <rect height="1291" width="154" x="1831" y="894"></rect>
              <rect height="969" width="154" x="2389" y="1216"></rect>
              <rect height="647" width="154" x="2948" y="1538"></rect>
              <rect height="799" width="154" x="3506" y="1386"></rect>
            </g>
            <desc>Axes =====</desc>
            <path d="M382 2185L382 469M435 2238L3791 2238" fill="none" stroke="DarkGray" stroke-width="11.4"></path>
            <desc>Key =====</desc>
            <desc>Block key</desc>
            <g fill="SteelBlue" stroke="Black" stroke-width="4">
              <rect height="63" width="153" x="525" y="2433"></rect>
            </g>
            <desc>Block key</desc>
            <g fill="DarkOrange" stroke="Black" stroke-width="4">
              <rect height="63" width="153" x="984" y="2433"></rect>
            </g>
            <g fill="Navy" font-family="Times New Roman" font-size="90">
              <text x="723" y="2496">1931</text>
            </g>
            <g fill="Navy" font-family="Times New Roman" font-size="90">
              <text x="1182" y="2496">1932</text>
            </g>
            <desc>Reset to original origin</desc>
          </g>
        </svg>
        <p>Now let's look at the same chart in <a href="https://altair-viz.github.io/gallery/grouped_bar_chart.html">Vega-Altair code</a> The data used here is the original, ungrouped barley data. The Altair code is:</p>
        <pre><code>import altair as alt
from vega_datasets import data
source = data.barley()
alt.Chart(source).mark_bar().encode(
    x='year:O',
    y='sum(yield):Q',
    color='year:N',
    column='site:N'
)
</code></pre>
        <p>Which compiles to the Vega-Lite code:  </p>
        <pre><code>{
  "config": {"view": {"continuousWidth": 300, "continuousHeight": 300}},
  "data": {"name": "data-093ece8c35bb2d41094cfb6138ec810b"},
  "mark": {"type": "bar"},
  "encoding": {
    "color": {"field": "year", "type": "nominal"},
    "column": {"field": "site", "type": "nominal"},
    "x": {"field": "year", "type": "ordinal"},
    "y": {"aggregate": "sum", "field": "yield", "type": "quantitative"}
  },..
   ...all the data inlined here...
   ...
</code></pre>
        <p>I will spare you the Vega code that the Vega-Lite code compiles to.</p>
        <p>Some observations: </p>
        <ol>
          <li>The data used here is the primary barley data, so the specification must <p>include aggregating the yield column with a sum function. </p></li>
          <li>Both the Altair and Vega code show the abstract<p>nature of the grammar of graphics.</p></li>
          <li>The <code>x</code> and <code>y</code> axes are explicitly specified, as opposed to SharpPlot's bar chart<p>definition, and Playfair, which takes a table and assumes the first column is the  categorical axis, the remaining columns are quantitative. (We could specify axes specifically in Playfair, but I'm not sure what benefit there is.)</p></li>
          <li>The <code>x</code> axis is specified as year, not site (farm). This seems a little strange.<p>It appears Vega treats the chart as a collection of mini barcharts each with year as the axis, rather than one chart with site as the x axis, where each tick mark has multiple values.  </p></li>
          <li>The <code>color</code> and <code>column</code> properties somehow specify the multi-level grouping by year<p>and by site (farm). It's not clear to me at all why these terms are used or how exactly this works. I'm sure there is a good reason, but it is certainly... abstract.</p></li>
        </ol>
        <p>Clearly Vega-Lite and Vega require a little more study.</p>
      </article>
      <h2>
        <a href="/posts">More posts...</a>
      </h2>
    </main>
    <footer>
      <p>Copyright 2023 Paul S. Mansour</p>
    </footer>
  </body>
</html>
